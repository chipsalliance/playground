From 72e9afc81a4ffeaa4e08bb2571017a22e337bcd6 Mon Sep 17 00:00:00 2001
From: Jiuyang Liu <liu@jiuyang.me>
Date: Sun, 18 Sep 2022 09:53:38 +0800
Subject: [PATCH] fix for chipsalliance/chisel3#2723

---
 src/main/scala/util/Annotations.scala | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/main/scala/util/Annotations.scala b/src/main/scala/util/Annotations.scala
index 5bce7335cd3..c553ef16ec1 100644
--- a/src/main/scala/util/Annotations.scala
+++ b/src/main/scala/util/Annotations.scala
@@ -170,12 +170,12 @@ trait DontTouch { self: RawModule =>
     *   (after Module(...))
     */
   def dontTouchPorts(): this.type = {
-    self.getModulePorts.foreach(dontTouch(_))
+    self.getModulePorts.map(_._1).foreach(dontTouch(_))
     self
   }
 
   def dontTouchPortsExcept(f: Data => Boolean): this.type = {
-    self.getModulePorts.filterNot(f).foreach(dontTouch(_))
+    self.getModulePorts.map(_._1).filterNot(f).foreach(dontTouch(_))
     self
   }
 }
